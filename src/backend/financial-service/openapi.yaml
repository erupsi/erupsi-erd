openapi: 3.0.4
info:
  title : Financial Service API
  version: 1.0.0
  description: API for managing financial internal operation in a company
    like chart of accounts, journal, ledger, reports, payroll, and tax
    within a microservices-based ERP system.
security:
  - bearerAuth: []
paths:
  /coa:
    get:
      summary: Get list of all accounts
      tags: [Chart of Accounts]
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema: { type: string }
          description: Filter berdasarkan jenis akun
        - name: parentCode
          in: query
          schema: { type: string }
          description: Ambil anak dari akun tertentu
      responses:
        '200':
          description: Daftar akun berhasil diambil
        '401':
          description: Tidak terautentikasi
          content:
            application/json:
              example:
                error: "Unauthorized"
                message: "Token tidak ditemukan atau tidak valid"
        '403':
          description: Tidak diizinkan
          content:
            application/json:
              example:
                error: "Forbidden"
                message: "Role Anda tidak memiliki akses"
        '500':
          description: Kesalahan server
          content:
            application/json:
              example:
                error: "Internal Error"
                message: "Terjadi kesalahan pada sistem"

    post:
      summary: Add new account
      tags: [Chart of Accounts]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Account'
      responses:
        '201':
          description: Akun berhasil ditambahkan
        '400':
            description: Data pengguna tidak valid, ada kolom yang belum diisi
        '401':
            description: Tidak terotentikasi
        '403':
            description: Tidak memiliki izin untuk mengakses sumber daya ini
        '500':
            description: Terjadi kesalahan pada server

  /coa/tree:
    get:
      summary: Get account in hierarcy structure(nested JSON)
      tags: [Chart of Accounts]
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema: { type: string }
          description: Filter berdasarkan jenis akun
        - name: parentCode
          in: query
          schema: { type: string }
          description: Ambil anak dari akun tertentu
      responses:
        '200':
          description: Akun berhasil diambil
        '401':
          description: Tidak terautentikasi
          content:
            application/json:
              example:
                error: "Unauthorized"
                message: "Token tidak ditemukan atau tidak valid"
        '403':
          description: Tidak diizinkan
          content:
            application/json:
              example:
                error: "Forbidden"
                message: "Role Anda tidak memiliki akses"
        '500':
          description: Kesalahan server
          content:
            application/json:
              example:
                error: "InternalError"
                message: "Terjadi kesalahan pada sistem"

  /coa/{id}:
    get:
      summary: Get detail account based on ID
      tags: [Chart of Accounts ID]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail akun ditemukan
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '404':
          description: Akun tidak ditemukan
          content:
            application/json:
              example:
                error: "Not Found"
                message: "Akun dengan ID tersebut tidak ditemukan"
    put:
      summary: Update account
      tags: [ Chart of Accounts ID ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Akun berhasil diperbarui
          content:
            application/json:
              example:
                message: "Akun berhasil diperbarui"
        '400':
          description: Format input salah
          content:
            application/json:
              example:
                error: "BadRequest"
                message: "Kode akun wajib diisi"
        '404':
          description: Akun tidak ditemukan
        '403':
          description: Akses ditolak

    delete:
      summary: Delete account
      tags: [Chart of Accounts ID]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Akun berhasil dihapus
        '404':
          description: Akun tidak ditemukan
          content:
            application/json:
              example:
                error: "Not Found"
                message: "Akun tidak ditemukan"
        '403':
          description: Tidak diizinkan menghapus akun ini

  /journal-entries:
    get:
      summary: Get all journal entries
      tags: [General Journal]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Daftar jurnal berhasil diambil
        '401':
          description: Token tidak valid
          content:
            application/json:
              example:
                error: "Unauthorized"
                message: "Missing or invalid token"
        '403':
          description: Role tidak diizinkan melihat jurnal
          content:
            application/json:
              example:
                error: "Forbidden"
                message: "Access denied"
        '500':
          description: Server error
          content:
            application/json:
              example:
                error: "InternalError"
                message: "Unexpected server failure"

    post:
      summary: Add journal entries
      tags: [ General Journal ]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JournalEntry'
      responses:
        '201':
          description: Entri jurnal berhasil ditambahkan
        '400':
            description: Data entri jurnal tidak valid, ada kolom yang belum diisi
        '401':
            description: Tidak terotentikasi
        '403':
            description: Tidak memiliki izin untuk mengakses sumber daya ini
        '500':
            description: Terjadi kesalahan pada server

  /journal-entries/{id}:
    get:
      summary: Get details from journal entries
      tags: [General Journal ID]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detail jurnal ditemukan
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak diizinkan
        '404':
          description: Entri jurnal tidak ditemukan
          content:
            application/json:
              example:
                error: "NotFound"
                message: "Journal entry not found with ID: JE-001"

    put:
      summary: Update journal entry
      tags: [General Journal ID]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/JournalEntry' }
            example:
              date: "2025-08-01"
              description: "Revisi transaksi sebelumnya"
              lines:
                - accountCode: "4110"
                  debit: 0
                  credit: 1000000
                - accountCode: "1110"
                  debit: 1000000
                  credit: 0
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Entri jurnal berhasil diperbarui
        '400':
          description: Deskripsi atau lines tidak valid
        '401':
          description: Token hilang/tidak valid
        '403':
          description: Role tidak diizinkan update
        '404':
          description: Entri tidak ditemukan
        '500':
          description: Error server

    delete:
      summary: Delete journal entries
      tags: [ General Journal ID ]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Entri jurnal berhasil dihapus
        '401':
          description: Tidak ada konten
        '403':
          description: Role tidak diizinkan menghapus jurnal
        '404':
          description: ID tak ditemukan
        '500':
          description: Terjadi kesalahan pada server

  /ledger:
    get:
      summary: See the transaction of all accounts
      tags: [General Ledger]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Transaksi akun berhasil diambil
        '404':
          description: Transaksi tidak ditemukan

  /ledger/{account code}:
    get:
      summary: See the transaction in an account
      tags: [General Ledger]
      parameters:
        - name: account code
          in: path
          required: true
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Transaksi akun ditemukan dan berhasil diambil
        '400':
            description: Kode akun tidak valid
        '401':
            description: Tidak terotentikasi
        '403':
            description: Tidak memiliki izin untuk mengakses sumber daya ini

  /reports/balance-sheet:
    get:
      summary: Get balance reports
      tags: [ Financial Reports ]
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            example: '2025-07'
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Laporan neraca berhasil diambil
        '400':
          description: Parameter periode tidak valid atau salah
        '401':
          description: Tidak terautentikasi

  /reports/pnl:
    get:
      summary: Get profit & loss reports
      tags: [ Financial Reports ]
      security:
        - bearerAuth: []
      parameters:
         - name: period
           in: query
           required: true
           schema:
              type: string
              pattern: '^\d{4}-\d{2}$'
           description: Periode laporan dalam format YYYY-MM
      responses:
          '200':
            description: Laporan laba rugi berhasil diambil
          '400':
            description: Parameter periode tidak valid atau salah
            content: 
              application/json:
                example: 
                  error: "BadRequest"
                  message: "Parameter 'period' harus dalam format YYYY-MM"
          '401':
            description: Token tidak valid
            content:
              application/json:
                example:
                  error: "unauthorized"
                  message: "Token tidak ditemukan atau tidak valid"
          '403':
            description: Role tidak punya hak akses
            content:
              application/json:
                example:
                    "error": "Forbidden",
                    "message": "Role Anda tidak memiliki akses ke laporan ini"
          '500':
            description: Kesalahan sistem atau server
            content:
              application/json:
                example:
                  "error": "Internal Error",
                  "message": "Terjadi kesalahan pada sistem saat membuat laporan"

  /reports/trial-balance:
    get:
      summary: Laporan Neraca Saldo
      tags: [ Financial Reports ]
      security:
        - bearerAuth: [ ]
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
          description: Periode laporan dalam format YYYY-MM
      responses:
        '200':
          description: Laporan berhasil ditemukan
        '400':
          description: Format periode salah
          content:
            application/json:
              example:
                error: "BadRequest"
                message: "Parameter 'period' harus dalam format YYYY-MM"
        '401':
          description: Token tidak valid
          content:
            application/json:
              example:
                error: "Unauthorized"
                message: "Token tidak ditemukan atau tidak valid"
        '403':
          description: Akses ditolak
          content:
            application/json:
              example:
                error: "Forbidden"
                message: "Anda tidak diizinkan melihat laporan ini"
        '500':
          description: Kesalahan sistem
          content:
            application/json:
              example:
                error: "InternalError"
                message: "Laporan gagal dibuat karena kesalahan sistem"

  /ap/invoices:
    get:
      summary: Retrieve all vendor invoices
      tags: [ Accounts Payable ]
      security:
          - bearerAuth: []
      responses:
        '200':
          description: Faktur vendor berhasil diambil
        '400':
          description: Status data tidak valid
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak memiliki akses
        '500':
          description: Kesalahan server
    post:
      summary: Add vendor invoice
      tags: [ Accounts Payable ]
      security:
        -   bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VendorInvoice'
            example:
              vendorId: "vendor123"
              dueDate: "2025-08-01"
              amount: 1500.00
              description: "Pembayaran untuk layanan konsultasi"
      responses:
        '201':
          description: Faktur vendor berhasil ditambahkan
        '400':
          description: Data faktur vendor tidak valid, ada kolom yang belum diisi
        '401':
          description: Tidak terautentikasi
        '403':
          description: Role tidak diizinkan

  /ap/invoices/{id}/payment:
    post:
      summary: Process payment vendor
      tags: [ Accounts Payable ]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [paidDate, method, referenceNo]
              properties:
                paidDate:
                  type: string
                  format: date
                method:
                  type: string
                example: "Bank Transfer"
              referenceNo:
                type: string
                example: "TRX-20250729-01"
              amount:
                type: number
                example: 1000000
      responses:
        '201':
          description: Pembayaran berhasil diproses
        '400':
          description: Data pembayaran tidak valid
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak memiliki akses untuk memproses pembayaran
        '404':
          description: Faktur vendor tidak ditemukan
        '409':
          description: Faktur sudah dibayar
        '500':
          description: Kesalahan server

  /ap-status/{invoiceId}:
    get:
      summary: Check status of payment vendor
      tags: [ Accounts Payable ]
      security:
        - bearerAuth: []
      parameters:
        - name: invoiceId
          in: path
          required: true
          schema:
             type: string
      responses:
        '200':
          description: Status pembayaran ditemukan
        '400':
          description: Format salah
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak memiliki izin akses
        '404':
          description: Faktur tidak ditemukan
        '500':
          description: Kesalahan server

  /ar/invoices:
    get:
      summary: Get all of the customer invoices
      tags: [Accounts Receivable]
      security:
        - bearerAuth: []
      parameters:
        - name: customerId
          in: query
          schema:
            type: string
          description: Filter berdasarkan ID customer

        - name: status
          in: query
          schema:
            type: string
            enum: [ unpaid, paid, overdue ]
          description: Filter status faktur

        - name: dueBefore
          in: query
          schema:
            type: string
            format: date
          description: Tampilkan faktur yang jatuh tempo sebelum tanggal tertentu
      responses:
        '200':
          description: Faktur customer berhasil diambil
        '400':
          description: Parameter tidak valid
        '401':
            description: Token tidak valid
        '403':
            description: Role tidak memiliki akses
        '500':
            description: Kesalahan server
    post:
      summary: Add customer invoice
      tags: [Accounts Receivable]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CustomerInvoice' }
            example:
              customerId: "C-2002"
              amount: 1800000
              dueDate: "2025-08-10"
      responses:
        '201':
          description: Faktur customer berhasil ditambahkan
        '400':
          description: Data tidak valid
        '401':
          description: Tidak terotentikasi
        '403':
          description: Tidak memiliki izin untuk mengakses sumber daya ini
        '404':
          description: Customer tidak ditemukan
        '409':
          description: Faktur customer sudah lunas
        '500':
          description: Terjadi kesalahan pada server

  /ar/invoices/{id}/receipt:
    post:
      summary: Record customer payment receipts
      tags: [ Accounts Receivable ]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
         description: Pembayaran customer dicatat

  /ar-status/{invoiceId}:
    get:
      summary: Check customer invoices payment status
      tags: [ Accounts Receivable ]
      security:
        - bearerAuth: [ ]
      parameters:
         - name: invoiceId
           in: path
           required: true
           schema:
             type: string
      responses:
        '200':
          description: Status pelunasan ditemukan
        '400':
          description: Format salah
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak memiliki izin akses
        '404':
          description: Faktur tidak ditemukan
        '500':
          description: Kesalahan server

  /payroll/summary:
    post:
      summary: Save payroll summary from HRM
      tags: [ Payroll Aggregation ]
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PayrollSummary' }
            example:
              period: "2025-07"
              totalSalary: 25000000
              totalTax: 1500000
              totalPotongan: 500000
      responses:
        '201':
          description: Ringkasan payroll berhasil disimpan
        '400':
          description: Format periode salah
          content:
            application/json:
              example:
                error: "BadRequest"
                message: "Parameter 'period' harus dalam format YYYY-MM"
        '401':
          description: Token tidak valid
          content:
            application/json:
              example:
                error: "Unauthorized"
                message: "Token tidak ditemukan atau tidak valid"
        '403':
          description: Role tidak memiliki akses
          content:
            application/json:
              example:
                error: "Forbidden"
                message: "Anda tidak diizinkan menyimpan ringkasan payroll"
        '409':
          description: Payroll periode ini sudah pernah dicatat
          content:
            application/json:
              example:
                error: "Conflict"
                message: "Payroll untuk periode ini sudah pernah dicatat"
        '500':
          description: Server error
          content:
            application/json:
              example:
                error: "InternalError"
                message: "Terjadi kesalahan pada sistem saat menyimpan ringkasan payroll"

    get:
      summary: Retrieve monthly payroll summary
      tags: [ Payroll Aggregation ]
      security:
        - bearerAuth: [ ]
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
          description: Periode payroll (YYYY-MM)
      responses:
        '200':
          description: Ringkasan payroll berhasil diambil
        '400':
          description: Format periode salah
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak bisa mengakses
        '404':
          description: Data tidak ditemukan
        '500':
          description: Kesalahan server

  /tax/rates:
    get:
      summary: Take a list of tax rates
      tags: [Tax Management]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Tarif pajak berhasil diambil
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak bisa mengakses
        '500':
          description: Kesalahan server
    post:
      summary: Add or set tax rates
      tags: [Tax Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TaxRate' }
            example:
              taxType: "PPN"
              rate: 0.11
      responses:
        '201':
          description: Tarif pajak berhasil disimpan
        '400':
          description: Data tidak valid
        '401':
          description: Tidak terautentikasi
        '403':
          description: Role tidak memiliki akses untuk mengatur tarif pajak
        '409':
          description: Pajak jenis ini sudah ada
        '500':
          description: Terjadi kesalahan pada server

  /tax/summary:
    get:
      summary: Retrieve tax liability summary
      tags: [Tax Management]
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Ringkasan pajak berhasil diambil
        '400':
          description: Format periode salah
        '401':
          description: Token tidak valid
        '403':
          description: Role tidak memiliki akses
        '404':
          description: Data tidak ditemukan
        '500':
          description: Kesalahan server

  /tax/calculate:
    post:
      summary: Calculate tax for transaction
      tags: [Tax Management]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TaxCalculationRequest' }
            example:
              transactionType: "penjualan"
              amount: 1000000
              taxType: "PPN"
      responses:
        '200':
          description: Pajak berhasil dihitung
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxCalculationResult'
              example:
                taxAmount: 110000
                taxRate: 0.11
        '400':
          description: Permintaan tidak valid
        '401':
          description: Tidak terautentikasi
        '403':
          description: Role tidak memiliki akses untuk menghitung pajak
        '422':
          description: Pajak tidak dapat dihitung
        '500':
          description: Terjadi kesalahan pada server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Account:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
        type:
          type: string
        parentCode:
          type: string
          nullable: true

    JournalEntry:
      type: object
      properties:
        date:
          type: string
          format: date
        description:
          type: string
        lines:
          type: array
          items:
            type: object
            properties:
              accountCode:
                type: string
              debit:
                type: number
              credit:
                type: number

    VendorInvoice:
      type: object
      properties:
        vendorId:
          type: string
        dueDate:
          type: string
          format: date
        amount:
          type: number
        description:
          type: string

    CustomerInvoice:
      type: object
      properties:
        customerId:
          type: string
        dueDate:
          type: string
          format: date
        amount:
          type: number
        description:
          type: string

    PayrollSummary:
      type: object
      properties:
        period:
          type: string
        totalSalary:
          type: number
        totalTax:
          type: number
        totalPotongan:
          type: number

    TaxRate:
      type: object
      properties:
        taxType:
          type: string
        rate:
          type: number

    TaxCalculationRequest:
      type: object
      properties:
        transactionType:
          type: string
        amount:
          type: number
        taxType:
          type: string

    TaxCalculationResult:
      type: object
      properties:
        taxAmount:
          type: number
        taxRate:
          type: number